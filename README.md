# Novel Analyser

Библиотека для комплексного анализа русскоязычных текстов визуальных новелл.

## Описание

Novel Analyser - это библиотека для всестороннего анализа текстов визуальных новелл и других литературных произведений на русском языке. Библиотека предлагает широкий набор инструментов для анализа текста, включая:

- Базовый анализ текста (количество блоков, время чтения)
- Анализ читаемости и сложности текста
- Нарративный анализ (структура повествования, ритм)
- Анализ эмоциональной окраски текста
- Тематическое моделирование
- Анализ персонажей и их диалогов
- Анализ повторяемости и стиля
- Кластеризацию текста на основе семантических эмбеддингов
- Семантический анализ (когерентность текста)

## Поддерживаемые форматы

На данный момент поддерживается только простой Twine формат сюжета. Библиотека может анализировать текстовые файлы, созданные с использованием Twine, где сюжет представлен в виде узлов и связей между ними.

Пример поддерживаемого синтаксиса сюжета:
```bash
# Реплика первого героя
ГЕРОЙ 1
Всё это пустой трёп.
Кабачки прекрасны.
Ты просто не шаришь, дурачок.

# Разделение между репликами - пуская строка.
ГЕРОЙ 2
Я хотяб ногти не крашу.

# Это нарратив без привязки к герою. Просто голос диктора или описание.
Герой 1 один был шокирован парированием героя 2 и потому активировал замедление времени.
```

### Ограничения текущей реализации

- Формат файла должен быть `.twee`

### Расширяемость на другие форматы

Это более сложная операция, но возможная. Библиотека поддерживает расширение парсинга различных форматов сюжета. Про это ниже в разделе "Расширяемость".

## Установка

### Требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)

### Установка из исходников

```bash
# Клонирование репозитория
git clone https://github.com/comiam/text_analysis.git
cd text_analysis

# Установка зависимостей
pip install -r requirements.txt
```

## Использование

### Комплексный анализ текста

Ниже приведен пример полного анализа текста с сохранением результатов и исследованием различных аспектов:

```python
from novel_analyser import RootAnalyser

# Инициализируем анализатор текста
analyser = RootAnalyser()

# Анализируем файл и сохраняем результаты в директорию 'results'
result = analyser.analyse_file(
    file_path="path/to/novel.twee",
    output_dir="results",
    analyses=["all"]  # или выберите конкретные анализы
)

# Просмотр результатов
print(result.summary)  # Краткое текстовое резюме
print(result.metrics)  # Все метрики анализа
print(result.figures)  # Пути к сохраненным визуализациям

# Доступны следующие типы анализа:
# - basic: базовый анализ текста
# - readability: анализ читаемости
# - narrative: анализ нарративной структуры
# - sentiment: анализ эмоциональной окраски
# - topic: тематическое моделирование
# - character: анализ персонажей
# - repetition: анализ повторяемости
# - clustering: кластеризация текста
# - semantic: семантический анализ
# - all: все вышеперечисленные анализы
```

### Использование отдельных анализаторов

Можно использовать отдельные анализаторы для более специфических задач:

```python
from novel_analyser import RootAnalyser

# Создаем экземпляр главного анализатора
analyser = RootAnalyser()

# Анализируем только выбранные аспекты текста
result = analyser.analyse_file(
    file_path="path/to/novel.twee",
    analyses=["sentiment", "character"]  # Только эмоциональная окраска и анализ персонажей
)

# Работа с текстом напрямую
text = """
ГЕРОЙ
Это пример диалога для анализа.
Он будет обработан напрямую.

ДРУГОЙ ГЕРОЙ
Конечно, это очень удобно!
"""

# Анализируем текст
result = analyser.analyse_text(text, analyses=["basic", "readability"])
```

### Использование из командной строки

Библиотека также предоставляет интерфейс командной строки:

```bash
# Полный анализ файла с сохранением результатов в директорию 'analysis'
python -m main /path/to/novel.twee --output analysis

# Указание конкретных анализов
python -m main /path/to/novel.twee --analyses basic sentiment character

# Использование собственного конфигурационного файла
python -m main /path/to/novel.twee --config my_config.yaml

# Использование только CPU (без GPU)
python -m main /path/to/novel.twee --cpu
```

## Конфигурация

Библиотека использует файлы конфигурации в формате YAML для настройки различных параметров анализа. По умолчанию используется файл `configs/default_config.yaml`. Пример конфигурации:

```yaml
# Конфигурация вывода результатов
output:
  output_dir: "analysis"
  metrics_file: "metrics.txt"

# Конфигурация моделей и устройств
model:
  use_gpu: true
  device_id: 0
  sentiment_model: "cointegrated/rubert-tiny-sentiment-balanced"
  embedding_model: "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"

# Общие параметры анализа
analyse:
  max_clusters: 20
  min_topics: 2
  max_topics: 20
  reading_speed_wpm: 150.0
```

Вы можете создать свой файл конфигурации, изменив любые параметры по своему усмотрению.

## Расширяемость

Библиотека спроектирована с учетом возможности расширения и подключения пользовательских модулей через плагинную систему. Это позволяет добавлять собственные:

- Парсеры текста для поддержки новых форматов ввода
- Обработчики эмоциональной окраски текста
- Энкодеры для создания эмбеддингов

Т.е. это расширяемо на другие форматы сюжетов.

### Создание собственного парсера

```python
from novel_analyser.core.interfaces import BaseParser

class MyCustomParser(BaseParser):
    def __init__(self, **kwargs):
        super().__init__()
        # Инициализация вашего парсера
    
    def parse_blocks(self, text, raw_style=False):
        # Реализация парсинга блоков
        pass
    
    def parse_character_dialogues(self, blocks):
        # Реализация извлечения диалогов персонажей
        pass
    
    def extract_sentences(self, text):
        # Реализация извлечения предложений
        pass
```

Затем вы можете использовать свой парсер, указав его в конфигурации:

```yaml
parser:
  module_path: "path.to.your.module.MyCustomParser"
  args:
    custom_parameter: value
```

## Структура результатов анализа

Результаты анализа сохраняются в указанной директории и включают:

1. **Метрики в текстовом файле** (metrics.txt): Содержит текстовое резюме и числовые метрики анализа
2. **Визуализации**: Графики, гистограммы и диаграммы для различных аспектов анализа
   - Гистограммы распределения эмоциональной окраски
   - Диаграммы тематического моделирования
   - Визуализация кластеров текста
   - И многое другое

## Создатели

Comiam

## Лицензия

